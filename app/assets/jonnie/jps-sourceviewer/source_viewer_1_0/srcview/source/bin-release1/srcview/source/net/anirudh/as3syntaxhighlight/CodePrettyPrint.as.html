<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>CodePrettyPrint.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">// Author: Anirudh Sasikumar (http://anirudhs.chaosnet.org/)
</span><span class="ActionScriptComment">// Copryright (C) 2009 Anirudh Sasikumar
</span>
<span class="ActionScriptComment">// as3syntaxhighlight is a port of google-code-prettify from
</span><span class="ActionScriptComment">// javascript to ActionScript 3. The AS3 version is strongly
</span><span class="ActionScriptComment">// typed, has changes to recognize AS within MXML, syntax highlights
</span><span class="ActionScriptComment">// function and var differently (.spl) so that coloring similar
</span><span class="ActionScriptComment">// to flex builder 3 is possible. It also includes some changes
</span><span class="ActionScriptComment">// which have been marked clearly as such.
</span>
<span class="ActionScriptComment">// The async version is completely my own. It uses Alex Harui&apos;s
</span><span class="ActionScriptComment">// pseudothread to syntax highlight as much as possible without
</span><span class="ActionScriptComment">// blocking the UI. It splits the code into chunks, works on each chunk
</span><span class="ActionScriptComment">// separately (but previous source and decoration info is maintained so
</span><span class="ActionScriptComment">// syntax is correctly lexed.)
</span>
<span class="ActionScriptComment">// The only tie in with Flex is PseudoThread. Otherwise this can be used
</span><span class="ActionScriptComment">// as pure AS3.
</span>
<span class="ActionScriptComment">// CodePrettyPrint class can output syntax highlighted code as HTML 
</span><span class="ActionScriptComment">// or as a decorations array which contain indexes and associated style.
</span><span class="ActionScriptComment">// The decorations can be leveraged for use in TextRange for in-place
</span><span class="ActionScriptComment">// highlighting. Note that TextRange (actually setTextFormat) is slow
</span><span class="ActionScriptComment">// compared to setting htmlText. The fastest way is to use the sync
</span><span class="ActionScriptComment">// version to generate HTML and set that as htmlText.
</span>
<span class="ActionScriptComment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
</span><span class="ActionScriptComment">// you may not use this file except in compliance with the License.
</span><span class="ActionScriptComment">// You may obtain a copy of the License at
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//      http://www.apache.org/licenses/LICENSE-2.0
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Unless required by applicable law or agreed to in writing, software
</span><span class="ActionScriptComment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
</span><span class="ActionScriptComment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class="ActionScriptComment">// See the License for the specific language governing permissions and
</span><span class="ActionScriptComment">// limitations under the License.
</span>
<span class="ActionScriptComment">// Original license for javascript (google-code-prettify) version follows:
</span>
<span class="ActionScriptComment">// Copyright (C) 2006 Google Inc.
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
</span><span class="ActionScriptComment">// you may not use this file except in compliance with the License.
</span><span class="ActionScriptComment">// You may obtain a copy of the License at
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">//      http://www.apache.org/licenses/LICENSE-2.0
</span><span class="ActionScriptComment">//
</span><span class="ActionScriptComment">// Unless required by applicable law or agreed to in writing, software
</span><span class="ActionScriptComment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
</span><span class="ActionScriptComment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span><span class="ActionScriptComment">// See the License for the specific language governing permissions and
</span><span class="ActionScriptComment">// limitations under the License.
</span>

<span class="ActionScriptASDoc">/**
 * @fileoverview
 * some functions for browser-side pretty printing of code contained in html.
 *
 * The lexer should work on a number of languages including C and friends,
 * Java, Python, Bash, SQL, HTML, XML, CSS, Javascript, and Makefiles.
 * It works passably on Ruby, PHP and Awk and a decent subset of Perl, but,
 * because of commenting conventions, doesn&apos;t work on Smalltalk, Lisp-like, or
 * CAML-like languages.
 *
 * If there&apos;s a language not mentioned here, then I don&apos;t know it, and don&apos;t
 * know whether it works.  If it has a C-like, Bash-like, or XML-like syntax
 * then it should work passably.
 */</span>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptDefault_Text">anirudh</span>.<span class="ActionScriptDefault_Text">as3syntaxhighlight</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">managers</span>.<span class="ActionScriptDefault_Text">ISystemManager</span>;
    
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">CodePrettyPrint</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/** the number of characters between tab columns */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_TAB_WIDTH</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 8;
        
        <span class="ActionScriptASDoc">/** Contains functions for creating and registering new language handlers.
         * @type {Object}
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
        
        <span class="ActionScriptASDoc">/**
         * A class that indicates a section of markup that is not code, e.g. to allow
         * embedding of line numbers within code listings.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_NOCODE</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;nocode&apos;</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">wordSet</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">words</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">words</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">words</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">/</span> <span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">g</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptReserved">set</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{}</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">words</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;=</span> 0;<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">w</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">words</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">w</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">set</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">w</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>; <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">set</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Define regexps here so that the interpreter doesn&apos;t have to create an
</span>        <span class="ActionScriptComment">// object each time the function containing them is called.
</span>        <span class="ActionScriptComment">// The language spec requires a new object created even if you don&apos;t access
</span>        <span class="ActionScriptComment">// the $1 members.
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_amp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">/&amp;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_lt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">/&lt;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_gt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">/&gt;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_quot</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">RegExp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\\\&quot;&quot;</span>, <span class="ActionScriptString">&quot;g&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptASDoc">/** like textToHtml but escapes double quotes to be attribute safe. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">attribToHtml</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">str</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_amp</span>, <span class="ActionScriptString">&apos;&amp;amp;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_lt</span>, <span class="ActionScriptString">&apos;&amp;lt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_gt</span>, <span class="ActionScriptString">&apos;&amp;gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_quot</span>, <span class="ActionScriptString">&apos;&amp;quot;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** escapest html special characters to html. */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">textToHtml</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">str</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">str</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_amp</span>, <span class="ActionScriptString">&apos;&amp;amp;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_lt</span>, <span class="ActionScriptString">&apos;&amp;lt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_gt</span>, <span class="ActionScriptString">&apos;&amp;gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_ltEnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/&amp;lt;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_gtEnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/&amp;gt;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_aposEnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/&amp;apos;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_quotEnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/&amp;quot;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_ampEnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/&amp;amp;/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_nbspEnt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/&amp;nbsp;/</span><span class="ActionScriptDefault_Text">g</span>;
        
        <span class="ActionScriptASDoc">/** unescapes html to plain text. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">htmlToText</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">html</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&amp;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">html</span>; <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptComment">// Handle numeric entities specially.  We can&apos;t use functional substitution
</span>            <span class="ActionScriptComment">// since that doesn&apos;t work in older versions of Safari.
</span>            <span class="ActionScriptComment">// These should be rare since most browsers convert them to normal chars.
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">pos</span>; <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&amp;#&apos;</span>, <span class="ActionScriptDefault_Text">pos</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">&gt;=</span> 0;<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;;&apos;</span>, <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span> <span class="ActionScriptOperator">+</span> 3, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">radix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 10;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">num</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptString">&apos;x&apos;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">num</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">num</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">radix</span> <span class="ActionScriptOperator">=</span> 16;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">codePoint</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span>, <span class="ActionScriptDefault_Text">radix</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">isNaN</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">codePoint</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">html</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">String</span>.<span class="ActionScriptDefault_Text">fromCharCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">codePoint</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span>
                                <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_ltEnt</span>, <span class="ActionScriptString">&apos;&lt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_gtEnt</span>, <span class="ActionScriptString">&apos;&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_aposEnt</span>, <span class="ActionScriptString">&quot;&apos;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_quotEnt</span>, <span class="ActionScriptString">&apos;&quot;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_ampEnt</span>, <span class="ActionScriptString">&apos;&amp;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_nbspEnt</span>, <span class="ActionScriptString">&apos; &apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        
        <span class="ActionScriptComment">// Keyword lists for various languages.
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">FLOW_CONTROL_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptString">&quot;break continue do else for if return while &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">C_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FLOW_CONTROL_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;auto case char const default &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;double enum extern float goto int long register short signed sizeof &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;static struct switch typedef union unsigned void volatile &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">COMMON_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">C_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;catch class delete false import &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;new operator private protected public this throw true try &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">CPP_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">COMMON_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;alignof align_union asm axiom bool &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;concept concept_map const_cast constexpr decltype &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;dynamic_cast explicit export friend inline late_check &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;mutable namespace nullptr reinterpret_cast static_assert static_cast &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;template typeid typename typeof using virtual wchar_t where &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">JAVA_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">COMMON_KEYWORDS</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;boolean byte extends final finally implements import instanceof null &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;native package strictfp super synchronized throws transient &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">CSHARP_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">JAVA_KEYWORDS</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;as base by checked decimal delegate descending event &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;fixed foreach from group implicit in interface internal into is lock &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;object out override orderby params readonly ref sbyte sealed &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;stackalloc string select uint ulong unchecked unsafe ushort var &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">JSCRIPT_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">COMMON_KEYWORDS</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;debugger eval export function get null set undefined var with &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;Infinity NaN &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PERL_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;caller delete die do dump elsif eval exit foreach for &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;goto if import last local my next no our print package redo require &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;sub undef unless until use wantarray while BEGIN END &quot;</span>;
      
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PYTHON_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FLOW_CONTROL_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;and as assert class def del &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;elif except exec finally from global import in is lambda &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;nonlocal not or pass print raise try with yield &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;False True None &quot;</span>;
            
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PHP_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;__CLASS__ __FILE__ __FUNCTION__ __LINE__ __METHOD__ &quot;</span> <span class="ActionScriptOperator">+</span> 
                <span class="ActionScriptString">&quot;abstract and array as break case catch cfunction class clone const continue declare default die do &quot;</span> <span class="ActionScriptOperator">+</span> 
                <span class="ActionScriptString">&quot;echo else elseif empty enddeclare endfor endforeach endif endswitch endwhile eval exception exit extends &quot;</span> <span class="ActionScriptOperator">+</span> 
                <span class="ActionScriptString">&quot;extends final for foreach function global if implements include include_once interface isset list new old_function &quot;</span> <span class="ActionScriptOperator">+</span> 
                <span class="ActionScriptString">&quot;or php_user_filter print private protected public require require_once return static switch this throw try unset use &quot;</span> <span class="ActionScriptOperator">+</span> 
                <span class="ActionScriptString">&quot;var while xor&quot;</span>;
            
            
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">RUBY_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FLOW_CONTROL_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;alias and begin case class def&quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot; defined elsif end ensure false in module next nil not or redo rescue &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;retry self super then true undef unless until when yield BEGIN END &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">SH_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">FLOW_CONTROL_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;case done elif esac eval fi &quot;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&quot;function in local set then until &quot;</span>;
       
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ALL_KEYWORDS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>
            <span class="ActionScriptDefault_Text">CPP_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">CSHARP_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">JSCRIPT_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">PERL_KEYWORDS</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptDefault_Text">PHP_KEYWORDS</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptDefault_Text">PYTHON_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">RUBY_KEYWORDS</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">SH_KEYWORDS</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptComment">// token style names.  correspond to css classes
</span>        <span class="ActionScriptASDoc">/** token style for a string literal */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_STRING</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;str&apos;</span>;
       
        <span class="ActionScriptASDoc">/** token style for a keyword */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_KEYWORD</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;kwd&apos;</span>;
       
        <span class="ActionScriptASDoc">/** token style for a comment */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_COMMENT</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;com&apos;</span>;
       
        <span class="ActionScriptASDoc">/** token style for a type */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_TYPE</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;typ&apos;</span>;
       
        <span class="ActionScriptASDoc">/** token style for a literal value.  e.g. 1, null, true. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_LITERAL</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;lit&apos;</span>;
       
        <span class="ActionScriptASDoc">/** token style for a punctuation string. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_PUNCTUATION</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;pun&apos;</span>;
       
        <span class="ActionScriptASDoc">/** token style for a punctuation string. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_PLAIN</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;pln&apos;</span>;
        
        <span class="ActionScriptASDoc">/** token style for an sgml tag. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_TAG</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;tag&apos;</span>;
        
        <span class="ActionScriptASDoc">/** token style for a markup declaration such as a DOCTYPE. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_DECLARATION</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;dec&apos;</span>;
        
        <span class="ActionScriptASDoc">/** token style for embedded source. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_SOURCE</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;src&apos;</span>;
        
        <span class="ActionScriptASDoc">/** token style for an sgml attribute name. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_ATTRIB_NAME</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;atn&apos;</span>;
        
        <span class="ActionScriptASDoc">/** token style for an sgml attribute value. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_ATTRIB_VALUE</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;atv&apos;</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isWordChar</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ch</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ch</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptString">&apos;a&apos;</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">ch</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptString">&apos;z&apos;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ch</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptString">&apos;A&apos;</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">ch</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptString">&apos;Z&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Splice one array into another.
         * Like the python &lt;code&gt;
         * container[containerPosition:containerPosition + countReplaced] = inserted
         * &lt;/code&gt;
         * @param {Array} inserted
         * @param {Array} container modified in place
         * @param {Number} containerPosition
         * @param {Number} countReplaced
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">spliceArrayInto</span><span class="ActionScriptBracket/Brace">(</span>
            <span class="ActionScriptDefault_Text">inserted</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">container</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">containerPosition</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">countReplaced</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">inserted</span>.<span class="ActionScriptDefault_Text">unshift</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">containerPosition</span>, <span class="ActionScriptDefault_Text">countReplaced</span> <span class="ActionScriptOperator">||</span> 0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">try</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">container</span>.<span class="ActionScriptDefault_Text">splice</span>.<span class="ActionScriptDefault_Text">apply</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span>, <span class="ActionScriptDefault_Text">inserted</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">finally</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">inserted</span>.<span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** A set of tokens that can precede a regular expression literal in
         * javascript.
         * http://www.mozilla.org/js/language/js20/rationale/syntax.html has the full
         * list, but I&apos;ve removed ones that might be problematic when seen in
         * languages that don&apos;t support regular expression literals.
         *
         * &lt;p&gt;Specifically, I&apos;ve removed any keywords that can&apos;t precede a regexp
         * literal in a syntactically legal javascript program, and I&apos;ve removed the
         * &quot;in&quot; keyword since it&apos;s not a keyword in many languages, and might be used
         * as a count of inches.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">regexpPrecederPattern</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">preceders</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span>
                <span class="ActionScriptString">&quot;!&quot;</span>, <span class="ActionScriptString">&quot;!=&quot;</span>, <span class="ActionScriptString">&quot;!==&quot;</span>, <span class="ActionScriptString">&quot;#&quot;</span>, <span class="ActionScriptString">&quot;%&quot;</span>, <span class="ActionScriptString">&quot;%=&quot;</span>, <span class="ActionScriptString">&quot;&amp;&quot;</span>, <span class="ActionScriptString">&quot;&amp;&amp;&quot;</span>, <span class="ActionScriptString">&quot;&amp;&amp;=&quot;</span>,
                <span class="ActionScriptString">&quot;&amp;=&quot;</span>, <span class="ActionScriptString">&quot;(&quot;</span>, <span class="ActionScriptString">&quot;*&quot;</span>, <span class="ActionScriptString">&quot;*=&quot;</span>, <span class="ActionScriptComment">/* &quot;+&quot;, */</span> <span class="ActionScriptString">&quot;+=&quot;</span>, <span class="ActionScriptString">&quot;,&quot;</span>, <span class="ActionScriptComment">/* &quot;-&quot;, */</span> <span class="ActionScriptString">&quot;-=&quot;</span>,
                <span class="ActionScriptString">&quot;-&gt;&quot;</span>, <span class="ActionScriptComment">/*&quot;.&quot;, &quot;..&quot;, &quot;...&quot;, handled below */</span> <span class="ActionScriptString">&quot;/&quot;</span>, <span class="ActionScriptString">&quot;/=&quot;</span>, <span class="ActionScriptString">&quot;:&quot;</span>, <span class="ActionScriptString">&quot;::&quot;</span>, <span class="ActionScriptString">&quot;;&quot;</span>,
                <span class="ActionScriptString">&quot;&lt;&quot;</span>, <span class="ActionScriptString">&quot;&lt;&lt;&quot;</span>, <span class="ActionScriptString">&quot;&lt;&lt;=&quot;</span>, <span class="ActionScriptString">&quot;&lt;=&quot;</span>, <span class="ActionScriptString">&quot;=&quot;</span>, <span class="ActionScriptString">&quot;==&quot;</span>, <span class="ActionScriptString">&quot;===&quot;</span>, <span class="ActionScriptString">&quot;&gt;&quot;</span>,
                <span class="ActionScriptString">&quot;&gt;=&quot;</span>, <span class="ActionScriptString">&quot;&gt;&gt;&quot;</span>, <span class="ActionScriptString">&quot;&gt;&gt;=&quot;</span>, <span class="ActionScriptString">&quot;&gt;&gt;&gt;&quot;</span>, <span class="ActionScriptString">&quot;&gt;&gt;&gt;=&quot;</span>, <span class="ActionScriptString">&quot;?&quot;</span>, <span class="ActionScriptString">&quot;@&quot;</span>, <span class="ActionScriptString">&quot;[&quot;</span>,
                <span class="ActionScriptString">&quot;^&quot;</span>, <span class="ActionScriptString">&quot;^=&quot;</span>, <span class="ActionScriptString">&quot;^^&quot;</span>, <span class="ActionScriptString">&quot;^^=&quot;</span>, <span class="ActionScriptString">&quot;{&quot;</span>, <span class="ActionScriptString">&quot;|&quot;</span>, <span class="ActionScriptString">&quot;|=&quot;</span>, <span class="ActionScriptString">&quot;||&quot;</span>,
                <span class="ActionScriptString">&quot;||=&quot;</span>, <span class="ActionScriptString">&quot;~&quot;</span> <span class="ActionScriptComment">/* handles =~ and !~ */</span>,
                <span class="ActionScriptString">&quot;break&quot;</span>, <span class="ActionScriptString">&quot;case&quot;</span>, <span class="ActionScriptString">&quot;continue&quot;</span>, <span class="ActionScriptString">&quot;delete&quot;</span>,
                <span class="ActionScriptString">&quot;do&quot;</span>, <span class="ActionScriptString">&quot;else&quot;</span>, <span class="ActionScriptString">&quot;finally&quot;</span>, <span class="ActionScriptString">&quot;instanceof&quot;</span>,
                <span class="ActionScriptString">&quot;return&quot;</span>, <span class="ActionScriptString">&quot;throw&quot;</span>, <span class="ActionScriptString">&quot;try&quot;</span>, <span class="ActionScriptString">&quot;typeof&quot;</span>
                                   <span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pattern</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;(?:&apos;</span> <span class="ActionScriptOperator">+</span>
            <span class="ActionScriptString">&apos;(?:(?:^|[^0-9.])\\.{1,3})|&apos;</span> <span class="ActionScriptOperator">+</span>  <span class="ActionScriptComment">// a dot that&apos;s not part of a number
</span>            <span class="ActionScriptString">&apos;(?:(?:^|[^\\+])\\+)|&apos;</span> <span class="ActionScriptOperator">+</span>  <span class="ActionScriptComment">// allow + but not ++
</span>            <span class="ActionScriptString">&apos;(?:(?:^|[^\\-])-)&apos;</span>;  <span class="ActionScriptComment">// allow - but not --
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">preceders</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">preceder</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">preceders</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isWordChar</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">preceder</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">pattern</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&apos;|\\b&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">preceder</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">pattern</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&apos;|&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">preceder</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/([^=&lt;&gt;:&amp;])/</span><span class="ActionScriptDefault_Text">g</span>, <span class="ActionScriptString">&apos;\\$1&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">pattern</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&apos;|^)\\s*$&apos;</span>;  <span class="ActionScriptComment">// matches at end, and matches empty string
</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">RegExp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pattern</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptComment">// CAVEAT: this does not properly handle the case where a regular
</span>            <span class="ActionScriptComment">// expression immediately follows another since a regular expression may
</span>            <span class="ActionScriptComment">// have flags for case-sensitivity and the like.  Having regexp tokens
</span>            <span class="ActionScriptComment">// adjacent is not
</span>            <span class="ActionScriptComment">// valid in any language I&apos;m aware of, so I&apos;m punting.
</span>            <span class="ActionScriptComment">// TODO: maybe style special characters inside a regexp as punctuation.
</span>        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">REGEXP_PRECEDER_PATTERN</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">regexpPrecederPattern</span>;
        
        <span class="ActionScriptComment">// The below pattern matches one of the following
</span>        <span class="ActionScriptComment">// (1) /[^&lt;]+/ : A run of characters other than &apos;&lt;&apos;
</span>        <span class="ActionScriptComment">// (2) /&lt;!--.*?--&gt;/: an HTML comment
</span>        <span class="ActionScriptComment">// (3) /&lt;!\[CDATA\[.*?\]\]&gt;/: a cdata section
</span>        <span class="ActionScriptComment">// (3) /&lt;\/?[a-zA-Z][^&gt;]*&gt;/ : A probably tag that should not be highlighted
</span>        <span class="ActionScriptComment">// (4) /&lt;/ : A &apos;&lt;&apos; that does not begin a larger chunk.  Treated as 1
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_chunkPattern</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span>
            <span class="ActionScriptString">/(?:[^&lt;]+|&lt;!--[\s\S]*?--&gt;|&lt;!\[CDATA\[([\s\S]*?)\]\]&gt;|&lt;\/?[a-zA-Z][^&gt;]*&gt;|&lt;)/</span><span class="ActionScriptDefault_Text">g</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_commentPrefix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^&lt;!--/</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_cdataPrefix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^&lt;\[CDATA\[/</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_brPrefix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^&lt;br\b/</span><span class="ActionScriptDefault_Text">i</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pr_tagNameRe</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^&lt;(\/?)([a-zA-Z]+)/</span>;
        
        <span class="ActionScriptASDoc">/** returns a function that expand tabs to spaces.  This function can be fed
         * successive chunks of text, and will maintain its own internal state to
         * keep track of how tabs are expanded.
         * @return {function (string) : string} a function that takes
         *   plain text and return the text with tabs expanded.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">makeTabExpander</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tabWidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">SPACES</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;                &apos;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">charInLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">plainText</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// walk over each character looking for tabs and newlines.
</span>                <span class="ActionScriptComment">// On tabs, expand them.  On newlines, reset charInLine.
</span>                <span class="ActionScriptComment">// Otherwise increment charInLine
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">out</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">plainText</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">n</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ch</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">plainText</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ch</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&apos;\t&apos;</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">out</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">out</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>; <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptDefault_Text">out</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">plainText</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">))</span>;
                            <span class="ActionScriptComment">// calculate how much space we need in front of this part
</span>                            <span class="ActionScriptComment">// nSpaces is the amount of padding -- the number of spaces needed
</span>                            <span class="ActionScriptComment">// to move us to the next column, where columns occur at factors of
</span>                            <span class="ActionScriptComment">// tabWidth.
</span>                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nSpaces</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tabWidth</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">charInLine</span> <span class="ActionScriptOperator">%</span> <span class="ActionScriptDefault_Text">tabWidth</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">charInLine</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">nSpaces</span>;
                            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span>; <span class="ActionScriptDefault_Text">nSpaces</span> <span class="ActionScriptOperator">&gt;=</span> 0; <span class="ActionScriptDefault_Text">nSpaces</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">SPACES</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> 
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">out</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SPACES</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">nSpaces</span><span class="ActionScriptBracket/Brace">))</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptDefault_Text">pos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1;
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&apos;\n&apos;</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptDefault_Text">charInLine</span> <span class="ActionScriptOperator">=</span> 0;
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">default</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">charInLine</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">out</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">plainText</span>; <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">out</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">plainText</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">out</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** split markup into chunks of html tags (style null) and
         * plain text (style {@link #PR_PLAIN}), converting tags which are
         * significant for tokenization (&lt;br&gt;) into their textual equivalent.
         *
         * @param {string} s html where whitespace is considered significant.
         * @return {Object} source code and extracted tags.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">extractTags</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> 
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// since the pattern has the &apos;g&apos; modifier and defines no capturing groups,
</span>            <span class="ActionScriptComment">// this will return a list of all chunks which we then classify and wrap as
</span>            <span class="ActionScriptComment">// PR_Tokens
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matches</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_chunkPattern</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceBuf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceBufLen</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matches</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">matches</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">n</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">matches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptString">&apos;&lt;&apos;</span><span class="ActionScriptBracket/Brace">)</span> 
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_commentPrefix</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">))</span> 
                        <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">continue</span>; 
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_cdataPrefix</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">))</span> 
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">// strip CDATA prefix and suffix.  Don&apos;t unescape since it&apos;s CDATA
</span>                            <span class="ActionScriptDefault_Text">sourceBuf</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>9, <span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 3<span class="ActionScriptBracket/Brace">))</span>;
                            <span class="ActionScriptDefault_Text">sourceBufLen</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 12;
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_brPrefix</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">))</span> 
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">// &lt;br&gt; tags are lexically significant so convert them to text.
</span>                            <span class="ActionScriptComment">// This is undone later.
</span>                            <span class="ActionScriptDefault_Text">sourceBuf</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\n&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">sourceBufLen</span>;
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PR_NOCODE</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;=</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">isNoCodeTag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">))</span> 
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">// A &lt;span class=&quot;nocode&quot;&gt; will start a section that should be
</span>                                <span class="ActionScriptComment">// ignored.  Continue walking the list until we see a matching end
</span>                                <span class="ActionScriptComment">// tag.
</span>                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_tagNameRe</span><span class="ActionScriptBracket/Brace">)[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">depth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1;
                              <span class="ActionScriptDefault_Text">end_tag_loop</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">n</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">matches</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pr_tagNameRe</span><span class="ActionScriptBracket/Brace">)</span>;
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name2</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">name2</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name2</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptString">&apos;/&apos;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">depth</span> <span class="ActionScriptOperator">===</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptReserved">break</span> <span class="ActionScriptDefault_Text">end_tag_loop</span>; 
                                            <span class="ActionScriptBracket/Brace">}</span>
                                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">depth</span>;
                                        <span class="ActionScriptBracket/Brace">}</span>
                                    <span class="ActionScriptBracket/Brace">}</span>
                                <span class="ActionScriptBracket/Brace">}</span>
                                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptDefault_Text">extractedTags</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                                        <span class="ActionScriptDefault_Text">sourceBufLen</span>, <span class="ActionScriptDefault_Text">matches</span>.<span class="ActionScriptDefault_Text">slice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span>, <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&apos;</span><span class="ActionScriptBracket/Brace">))</span>;
                                    <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">j</span>;
                                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>  <span class="ActionScriptComment">// Ignore unclosed sections.
</span>                                    <span class="ActionScriptDefault_Text">extractedTags</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceBufLen</span>, <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">extractedTags</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceBufLen</span>, <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">literalText</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">htmlToText</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">sourceBuf</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">literalText</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">sourceBufLen</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">literalText</span>.<span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">sourceBuf</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&apos;</span><span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">tags</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">extractedTags</span> <span class="ActionScriptBracket/Brace">}</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** True if the given tag contains a class attribute with the nocode class. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">isNoCodeTag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">!!</span><span class="ActionScriptDefault_Text">tag</span>
                <span class="ActionScriptComment">// First canonicalize the representation of attributes
</span>                .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\s(\w+)\s*=\s*(?:\&quot;([^\&quot;]*)\&quot;|&apos;([^\&apos;]*)&apos;|(\S+))/</span><span class="ActionScriptDefault_Text">g</span>,
                         <span class="ActionScriptString">&apos; $1=&quot;$2$3$4&quot;&apos;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptComment">// Then look for the attribute we want.
</span>                .<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/[cC][lL][aA][sS][sS]=\&quot;[^\&quot;]*\bnocode\b/</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Given triples of [style, pattern, context] returns a lexing function,
         * The lexing function interprets the patterns to find token boundaries and
         * returns a decoration list of the form
         * [index_0, style_0, index_1, style_1, ..., index_n, style_n]
         * where index_n is an index into the sourceCode, and style_n is a style
         * constant like PR_PLAIN.  index_n-1 &lt;= index_n, and style_n-1 applies to
         * all characters in sourceCode[index_n-1:index_n].
         *
         * The stylePatterns is a list whose elements have the form
         * [style : string, pattern : RegExp, context : RegExp, shortcut : string].
         &amp;
         * Style is a style constant like PR_PLAIN.
         *
         * Pattern must only match prefixes, and if it matches a prefix and context
         * is null or matches the last non-comment token parsed, then that match is
         * considered a token with the same style.
         *
         * Context is applied to the last non-whitespace, non-comment token
         * recognized.
         *
         * Shortcut is an optional string of characters, any of which, if the first
         * character, gurantee that this pattern and only this pattern matches.
         *
         * @param {Array} shortcutStylePatterns patterns that always start with
         *   a known character.  Must have a shortcut string.
         * @param {Array} fallthroughStylePatterns patterns that will be tried in
         *   order if the shortcut ones fail.  May have shortcuts.
         *
         * @return {function (string, number?) : Array.&lt;number|string&gt;} a
         *   function that takes source code and returns a list of decorations.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createSimpleLexer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">shortcutStylePatterns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>,
                                   <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shortcuts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{}</span>;
            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptfunction">function</span> <span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">allPatterns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shortcutStylePatterns</span>.<span class="ActionScriptDefault_Text">concat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fallthroughStylePatterns</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">allPatterns</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;=</span> 0;<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">allPatterns</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shortcutChars</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">shortcutChars</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shortcutChars</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">&gt;=</span> 0;<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">shortcuts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">shortcutChars</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">patternParts</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">})()</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nPatterns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">notWs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">\S</span><span class="ActionScriptOperator">/</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">opt_basePos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">opt_basePos</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">opt_basePos</span> <span class="ActionScriptOperator">||</span> 0;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">opt_basePos</span>, <span class="ActionScriptDefault_Text">PR_PLAIN</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lastToken</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&apos;&apos;</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;  <span class="ActionScriptComment">// index into sourceCode
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tail</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceCode</span>;
                
                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tail</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">token</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
                    
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">shortcuts</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tail</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)]</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">match</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tail</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>;
                        <span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                   
                        <span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">nPatterns</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">patternParts</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptComment">//Anirudh: should contextPattern be RegExp?
</span>                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">contextPattern</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptComment">/* Changed by anirudh. fix this */</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">contextPattern</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">contextPattern</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">contextPattern</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lastToken</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptComment">// rule can&apos;t be used
</span>                                <span class="ActionScriptReserved">continue</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptDefault_Text">match</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tail</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>;
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                             
                                    
                                <span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">patternParts</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                                <span class="ActionScriptComment">//Hack by Anirudh to highlight var &amp; function diff
</span>                                <span class="ActionScriptComment">//so that highlight matches that of Flex Builder
</span>                                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;var&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;function&quot;</span> <span class="ActionScriptBracket/Brace">)</span>
                                   <span class="ActionScriptBracket/Brace">{</span>
                                       <span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;spl&quot;</span>;                                       
                                   <span class="ActionScriptBracket/Brace">}</span>
                                <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">token</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>  <span class="ActionScriptComment">// make sure that we make progress
</span>                            <span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PR_PLAIN</span>;
                            <span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tail</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>0, 1<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                   <span class="ActionScriptComment">//trace(&quot;found special keywords &quot; + token  + &quot; &quot; + style);
</span>                  
                    
                    <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_basePos</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">pos</span>, <span class="ActionScriptDefault_Text">style</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">pos</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">token</span>.<span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptDefault_Text">tail</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tail</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">token</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">!==</span> <span class="ActionScriptDefault_Text">PR_COMMENT</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">notWs</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">token</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">lastToken</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">token</span>; <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
            <span class="ActionScriptBracket/Brace">}</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_MARKUP_LEXER</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createSimpleLexer</span><span class="ActionScriptBracket/Brace">([]</span>, <span class="ActionScriptBracket/Brace">[</span>
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PLAIN</span>,       <span class="ActionScriptString">/^[^&lt;]+/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_DECLARATION</span>, <span class="ActionScriptString">/^&lt;!\w[^&gt;]*(?:&gt;|$)/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_COMMENT</span>,     <span class="ActionScriptString">/^&lt;!--[\s\S]*?(?:--&gt;|$)/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_SOURCE</span>,      <span class="ActionScriptString">/^&lt;\?[\s\S]*?(?:\?&gt;|$)/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_SOURCE</span>,      <span class="ActionScriptString">/^&lt;%[\s\S]*?(?:%&gt;|$)/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_SOURCE</span>,
                                                     <span class="ActionScriptComment">// Tags whose content is not escaped, and which contain source code.
</span>                                                     <span class="ActionScriptOperator">/^&lt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">script</span><span class="ActionScriptOperator">|</span><span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">|</span><span class="ActionScriptDefault_Text">xmp</span><span class="ActionScriptOperator">|</span><span class="ActionScriptDefault_Text">mx\</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Script</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptDefault_Text">\b</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptOperator">^&gt;</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*&gt;</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">\s\S</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*?&lt;</span><span class="ActionScriptDefault_Text">\</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">\1\b</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptOperator">^&gt;</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*&gt;/</span><span class="ActionScriptDefault_Text">i</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_TAG</span>,         <span class="ActionScriptString">/^&lt;\/?\w[^&lt;&gt;]*&gt;/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>
                                                     <span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptComment">// Splits any of the source|style|xmp entries above into a start tag,
</span>        <span class="ActionScriptComment">// source content, and end tag.
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_SOURCE_CHUNK_PARTS</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^(&lt;[^&gt;]*&gt;)([\s\S]*)(&lt;\/[^&gt;]*&gt;)$/</span>;
        <span class="ActionScriptASDoc">/** split markup on tags, comments, application directives, and other top
         * level constructs.  Tags are returned as a single token - attributes are
         * not yet broken out.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">tokenizeMarkup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PR_MARKUP_LEXER</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_SOURCE</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
                    <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptComment">// Split out start and end script tags as actual tags, and leave the
</span>                    <span class="ActionScriptComment">// body with style SCRIPT.
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceChunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">match</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceChunk</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PR_SOURCE_CHUNK_PARTS</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">match</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">match</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 2 <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">splice</span><span class="ActionScriptBracket/Brace">(</span>
                            <span class="ActionScriptDefault_Text">i</span>, 2,
                            <span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">PR_TAG</span>,  <span class="ActionScriptComment">// the open chunk
</span>                            <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span>, <span class="ActionScriptDefault_Text">PR_SOURCE</span>,
                            <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptString">&apos;&apos;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span>, <span class="ActionScriptDefault_Text">PR_TAG</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">PR_TAG_LEXER</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createSimpleLexer</span><span class="ActionScriptBracket/Brace">([</span>
                                                 <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_ATTRIB_VALUE</span>, <span class="ActionScriptString">/^\&apos;[^\&apos;]*(?:\&apos;|$)/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&quot;&apos;&quot;</span><span class="ActionScriptBracket/Brace">]</span>,
                                                 <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_ATTRIB_VALUE</span>, <span class="ActionScriptString">/^\&quot;[^\&quot;]*(?:\&quot;|$)/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;&quot;&apos;</span><span class="ActionScriptBracket/Brace">]</span>,
                                                 <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PUNCTUATION</span>,  <span class="ActionScriptString">/^[&lt;&gt;\/=]+/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;&lt;&gt;/=&apos;</span><span class="ActionScriptBracket/Brace">]</span>
                                              <span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptBracket/Brace">[</span>
                                                  <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_TAG</span>,          <span class="ActionScriptString">/^[\w:\-]+/</span>, <span class="ActionScriptString">/^&lt;/</span><span class="ActionScriptBracket/Brace">]</span>,
                                                  <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_ATTRIB_VALUE</span>, <span class="ActionScriptString">/^[\w\-]+/</span>, <span class="ActionScriptString">/^=/</span><span class="ActionScriptBracket/Brace">]</span>,
                                                  <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_ATTRIB_NAME</span>,  <span class="ActionScriptString">/^[\w:\-]+/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                  <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PLAIN</span>,        <span class="ActionScriptString">/^\s+/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos; \t\r\n&apos;</span><span class="ActionScriptBracket/Brace">]</span>
                                                  <span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptASDoc">/** split tags attributes and their values out from the tag name, and
         * recursively lex source chunks.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">splitTagAttributes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//should style be a String?
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_TAG</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
                    <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subDecorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PR_TAG_LEXER</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>, <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">spliceArrayInto</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subDecorations</span>, <span class="ActionScriptDefault_Text">decorations</span>, <span class="ActionScriptDefault_Text">i</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subDecorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 2;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** returns a function that produces a list of decorations from source text.
         *
         * This code treats &quot;, &apos;, and ` as string delimiters, and \ as a string
         * escape.  It does not recognize perl&apos;s qq() style strings.
         * It has no special handling for double delimiter escapes as in basic, or
         * the tripled delimiters used in python, but should work on those regardless
         * although in those cases a single string literal may be broken up into
         * multiple adjacent string literals.
         *
         * It recognizes C, C++, and shell style comments.
         *
         * @param {Object} options a set of optional parameters.
         * @return {function (string) : Array.&lt;string|number&gt;} a
         *     decorator that takes sourceCode as plain text and that returns a
         *     decoration list
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shortcutStylePatterns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>, <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span>.<span class="ActionScriptDefault_Text">tripleQuotedStrings</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// &apos;&apos;&apos;multi-line-string&apos;&apos;&apos;, &apos;single-line-string&apos;, and double-quoted
</span>                <span class="ActionScriptDefault_Text">shortcutStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_STRING</span>,  <span class="ActionScriptString">/^(?:\&apos;\&apos;\&apos;(?:[^\&apos;\\]|\\[\s\S]|\&apos;{1,2}(?=[^\&apos;]))*(?:\&apos;\&apos;\&apos;|$)|\&quot;\&quot;\&quot;(?:[^\&quot;\\]|\\[\s\S]|\&quot;{1,2}(?=[^\&quot;]))*(?:\&quot;\&quot;\&quot;|$)|\&apos;(?:[^\\\&apos;]|\\[\s\S])*(?:\&apos;|$)|\&quot;(?:[^\\\&quot;]|\\[\s\S])*(?:\&quot;|$))/</span>,
                     <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;\&apos;&quot;&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span>.<span class="ActionScriptDefault_Text">multiLineStrings</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// &apos;multi-line-string&apos;, &quot;multi-line-string&quot;
</span>                <span class="ActionScriptDefault_Text">shortcutStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_STRING</span>,  <span class="ActionScriptString">/^(?:\&apos;(?:[^\\\&apos;]|\\[\s\S])*(?:\&apos;|$)|\&quot;(?:[^\\\&quot;]|\\[\s\S])*(?:\&quot;|$)|\`(?:[^\\\`]|\\[\s\S])*(?:\`|$))/</span>,
                     <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;\&apos;&quot;`&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// &apos;single-line-string&apos;, &quot;single-line-string&quot;
</span>                <span class="ActionScriptDefault_Text">shortcutStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_STRING</span>,
                     <span class="ActionScriptString">/^(?:\&apos;(?:[^\\\&apos;\r\n]|\\.)*(?:\&apos;|$)|\&quot;(?:[^\\\&quot;\r\n]|\\.)*(?:\&quot;|$))/</span>,
                     <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;&quot;\&apos;&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PLAIN</span>,   <span class="ActionScriptString">/^(?:[^\&apos;\&quot;\`\/\#]+)/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos; \r\n&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span>.<span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">shortcutStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">([</span><span class="ActionScriptDefault_Text">PR_COMMENT</span>, <span class="ActionScriptString">/^#[^\r\n]*/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;#&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span>.<span class="ActionScriptDefault_Text">cStyleComments</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">([</span><span class="ActionScriptDefault_Text">PR_COMMENT</span>, <span class="ActionScriptString">/^\/\/[^\r\n]*/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_COMMENT</span>, <span class="ActionScriptString">/^\/\*[\s\S]*?(?:\*\/|$)/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span>.<span class="ActionScriptDefault_Text">regexLiterals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">REGEX_LITERAL</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptComment">// A regular expression literal starts with a slash that is
</span>                    <span class="ActionScriptComment">// not followed by * or / so that it is not confused with
</span>                    <span class="ActionScriptComment">// comments.
</span>                    <span class="ActionScriptString">&apos;^/(?=[^/*])&apos;</span>
                    <span class="ActionScriptComment">// and then contains any number of raw characters,
</span>                    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;(?:[^/\\x5B\\x5C\\x0A\\x0D]&apos;</span>
                    <span class="ActionScriptComment">// escape sequences (\x5C),
</span>                    <span class="ActionScriptOperator">+</span>    <span class="ActionScriptString">&apos;|\\x5C[\\t \\S]&apos;</span>
                    <span class="ActionScriptComment">// or non-nesting character sets (\x5B\x5D);
</span>                    <span class="ActionScriptOperator">+</span>    <span class="ActionScriptString">&apos;|\\x5B(?:[^\\x5C\\x5D]|\\x5C[\\t \\S])*(?:\\x5D|$))+&apos;</span>
                    <span class="ActionScriptComment">// finally closed by a /.
</span>                    <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;(?:/|$)&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>
                    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_STRING</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">RegExp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">REGEX_LITERAL</span><span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">REGEXP_PRECEDER_PATTERN</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">wordSet</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">options</span>.<span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">options</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            
            <span class="ActionScriptASDoc">/** splits the given string into comment, string, and &quot;other&quot; tokens.
             * @param {string} sourceCode as plain text
             * @return {Array.&lt;number|string&gt;} a decoration list.
             * @private
             */</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">splitStringAndCommentTokens</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createSimpleLexer</span><span class="ActionScriptBracket/Brace">(</span>
                <span class="ActionScriptDefault_Text">shortcutStylePatterns</span>, <span class="ActionScriptDefault_Text">fallthroughStylePatterns</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">styleLiteralIdentifierPuncRecognizer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">createSimpleLexer</span><span class="ActionScriptBracket/Brace">([]</span>, <span class="ActionScriptBracket/Brace">[</span>
                                                                             <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PLAIN</span>,       <span class="ActionScriptString">/^\s+/</span>, <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos; \r\n&apos;</span><span class="ActionScriptBracket/Brace">]</span>,
                                                                             <span class="ActionScriptComment">// TODO(mikesamuel): recognize non-latin letters and numerals in idents
</span>                                                                             <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PLAIN</span>,       <span class="ActionScriptString">/^[a-z_$@][a-z_$@0-9]*/</span><span class="ActionScriptDefault_Text">i</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                                             <span class="ActionScriptComment">// A hex number
</span>                                                                             <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_LITERAL</span>,     <span class="ActionScriptString">/^0x[a-f0-9]+[a-z]/</span><span class="ActionScriptDefault_Text">i</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>,
                                                                             <span class="ActionScriptComment">// An octal or decimal number, possibly in scientific notation
</span>                                                                             <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_LITERAL</span>,
                                                                              <span class="ActionScriptString">/^(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d+)(?:e[+\-]?\d+)?[a-z]*/</span><span class="ActionScriptDefault_Text">i</span>,
                                                                              <span class="ActionScriptReserved">null</span>, <span class="ActionScriptString">&apos;123456789&apos;</span><span class="ActionScriptBracket/Brace">]</span>,
                                                                             <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">PR_PUNCTUATION</span>, <span class="ActionScriptString">/^[^\s\w\.$@]+/</span>, <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">]</span>
                                                                             <span class="ActionScriptComment">// Fallback will handle decimal points not adjacent to a digit
</span>                                                                              <span class="ActionScriptBracket/Brace">])</span>;
            
            <span class="ActionScriptASDoc">/** splits plain text tokens into more specific tokens, and then tries to
             * recognize keywords, and types.
             * @private
             */</span>
            <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">splitNonStringNonCommentTokens</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_PLAIN</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">chunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
                        <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">length</span>;
                        <span class="ActionScriptDefault_Text">chunk</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">subDecs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">styleLiteralIdentifierPuncRecognizer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunk</span>, <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">subDecs</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subStyle</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subStyle</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_PLAIN</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subStart</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>;
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subEnd</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">chunk</span>.<span class="ActionScriptDefault_Text">length</span>;
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">token</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subStart</span>, <span class="ActionScriptDefault_Text">subEnd</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptString">&apos;.&apos;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PR_PUNCTUATION</span>;
                                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">token</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">PR_KEYWORD</span>;
                                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/^@?[A-Z][A-Z$]*[a-z][A-Za-z$]*$/</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">token</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptComment">// classify types and annotations using Java&apos;s style conventions
</span>                                    <span class="ActionScriptDefault_Text">subDecs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">token</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptString">&apos;@&apos;</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">PR_LITERAL</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">PR_TYPE</span>;
                                <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptDefault_Text">spliceArrayInto</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subDecs</span>, <span class="ActionScriptDefault_Text">decorations</span>, <span class="ActionScriptDefault_Text">i</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subDecs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 2;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Split into strings, comments, and other.
</span>                <span class="ActionScriptComment">// We do this because strings and comments are easily recognizable and can
</span>                <span class="ActionScriptComment">// contain stuff that looks like other tokens, so we want to mark those
</span>                <span class="ActionScriptComment">// early so we don&apos;t recurse into them.
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">splitStringAndCommentTokens</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">// Split non comment|string tokens on whitespace and word boundaries
</span>                <span class="ActionScriptDefault_Text">decorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">splitNonStringNonCommentTokens</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorateSource</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
              <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">ALL_KEYWORDS</span>,
              <span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
              <span class="ActionScriptDefault_Text">cStyleComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
              <span class="ActionScriptDefault_Text">multiLineStrings</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
              <span class="ActionScriptComment">//regexLiterals: true
</span>              <span class="ActionScriptComment">//Change by Anirudh
</span>              <span class="ActionScriptDefault_Text">regexLiterals</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
            <span class="ActionScriptBracket/Brace">})</span>;
        
        <span class="ActionScriptASDoc">/** identify regions of markup that are really source code, and recursivley
         * lex them.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">splitSourceNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_SOURCE</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Recurse using the non-markup lexer
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
                    <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subDecorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorateSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">subDecorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">subDecorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">start</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">spliceArrayInto</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subDecorations</span>, <span class="ActionScriptDefault_Text">decorations</span>, <span class="ActionScriptDefault_Text">i</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">subDecorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 2;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">quoteReg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">RegExp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;^[\\\&quot;\\&apos;]&quot;</span>,<span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        
        <span class="ActionScriptASDoc">/** identify attribute values that really contain source code and recursively
         * lex them.
         * @private
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">splitSourceAttributes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nextValueIsSource</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">style</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_ATTRIB_NAME</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">length</span>;
                    <span class="ActionScriptDefault_Text">nextValueIsSource</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^on|^style$/</span><span class="ActionScriptDefault_Text">i</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">style</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">PR_ATTRIB_VALUE</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nextValueIsSource</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2 <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">length</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attribValue</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attribLen</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">attribValue</span>.<span class="ActionScriptDefault_Text">length</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">quoted</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span>
                            <span class="ActionScriptComment">//(attribLen &gt;= 2 &amp;&amp; /^[\&quot;\&apos;]/.test(attribValue) &amp;&amp;
</span>                            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribLen</span> <span class="ActionScriptOperator">&gt;=</span> 2 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">quoteReg</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribValue</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span>
                             <span class="ActionScriptDefault_Text">attribValue</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">attribValue</span>.<span class="ActionScriptDefault_Text">charAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribLen</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">))</span>;
                        
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attribSource</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attribSourceStart</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attribSourceEnd</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quoted</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">attribSourceStart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">+</span> 1;
                            <span class="ActionScriptDefault_Text">attribSourceEnd</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">-</span> 1;
                            <span class="ActionScriptDefault_Text">attribSource</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">attribValue</span>;
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">attribSourceStart</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">+</span> 1;
                            <span class="ActionScriptDefault_Text">attribSourceEnd</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">-</span> 1;
                            <span class="ActionScriptDefault_Text">attribSource</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">attribValue</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">attribValue</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">attribSourceDecorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorateSource</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribSource</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">attribSourceDecorations</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">m</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+=</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">attribSourceDecorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">attribSourceStart</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">quoted</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">attribSourceDecorations</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribSourceEnd</span>, <span class="ActionScriptDefault_Text">PR_ATTRIB_VALUE</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">spliceArrayInto</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribSourceDecorations</span>, <span class="ActionScriptDefault_Text">decorations</span>, <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 2, 0<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">spliceArrayInto</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">attribSourceDecorations</span>, <span class="ActionScriptDefault_Text">decorations</span>, <span class="ActionScriptDefault_Text">i</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">nextValueIsSource</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** returns a decoration list given a string of markup.
         *
         * This code recognizes a number of constructs.
         * &lt;!-- ... --&gt; comment
         * &lt;!\w ... &gt;   declaration
         * &lt;\w ... &gt;    tag
         * &lt;/\w ... &gt;   tag
         * &lt;?...?&gt;      embedded source
         * &lt;%...%&gt;      embedded source
         * &amp;[#\w]...;   entity
         *
         * It does not recognizes %foo; doctype entities from  .
         *
         * It will recurse into any &lt;style&gt;, &lt;script&gt;, and on* attributes using
         * PR_lexSource.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">decorateMarkup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// This function works as follows:
</span>            <span class="ActionScriptComment">// 1) Start by splitting the markup into text and tag chunks
</span>            <span class="ActionScriptComment">//    Input:  string s
</span>            <span class="ActionScriptComment">//    Output: List&lt;PR_Token&gt; where style in (PR_PLAIN, null)
</span>            <span class="ActionScriptComment">// 2) Then split the text chunks further into comments, declarations,
</span>            <span class="ActionScriptComment">//    tags, etc.
</span>            <span class="ActionScriptComment">//    After each split, consider whether the token is the start of an
</span>            <span class="ActionScriptComment">//    embedded source section, i.e. is an open &lt;script&gt; tag.  If it is, find
</span>            <span class="ActionScriptComment">//    the corresponding close token, and don&apos;t bother to lex in between.
</span>            <span class="ActionScriptComment">//    Input:  List&lt;string&gt;
</span>            <span class="ActionScriptComment">//    Output: List&lt;PR_Token&gt; with style in
</span>            <span class="ActionScriptComment">//            (PR_TAG, PR_PLAIN, PR_SOURCE, null)
</span>            <span class="ActionScriptComment">// 3) Finally go over each tag token and split out attribute names and
</span>            <span class="ActionScriptComment">//    values.
</span>            <span class="ActionScriptComment">//    Input:  List&lt;PR_Token&gt;
</span>            <span class="ActionScriptComment">//    Output: List&lt;PR_Token&gt; where style in
</span>            <span class="ActionScriptComment">//            (PR_TAG, PR_PLAIN, PR_SOURCE, NAME, VALUE, null)
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tokenizeMarkup</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">decorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">splitTagAttributes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">decorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">splitSourceNodes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">decorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">splitSourceAttributes</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCode</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">decorations</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//Added by Anirudh
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mainDecorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mainHtml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">prettyPrintStopAsyc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
        
        <span class="ActionScriptASDoc">/**
         * @param {string} sourceText plain text
         * @param {Array.&lt;number|string&gt;} extractedTags chunks of raw html preceded
         *   by their position in sourceText in order.
         * @param {Array.&lt;number|string&gt;} decorations style classes preceded by their
         *   position in sourceText in order.
         * @return {string} html
         * @private
         */</span>         
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">recombineTagsAndDecorations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceText</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">html</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptComment">// index past the last char in sourceText written to html
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">outputIdx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptComment">//mainDecorations = decorations;
</span>            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">openDecoration</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">currentDecoration</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tagPos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;  <span class="ActionScriptComment">// index into extractedTags
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decPos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;  <span class="ActionScriptComment">// index into decorations
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tabExpander</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">makeTabExpander</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PR_TAB_WIDTH</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">adjacentSpaceRe</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/([\r\n ]) /</span><span class="ActionScriptDefault_Text">g</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">startOrSpaceRe</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/(^| ) /</span><span class="ActionScriptDefault_Text">gm</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">newlineRe</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/\r\n?|\n/</span><span class="ActionScriptDefault_Text">g</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">trailingSpaceRe</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/[ \r\n]$/</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lastWasSpace</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;  <span class="ActionScriptComment">// the last text chunk emitted ended with a space.
</span>            
            <span class="ActionScriptComment">// A helper function that is responsible for opening sections of decoration
</span>            <span class="ActionScriptComment">// and outputing properly escaped chunks of source
</span>            <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">emitTextUpTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceIdx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceIdx</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">outputIdx</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">openDecoration</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">openDecoration</span> <span class="ActionScriptOperator">!==</span> <span class="ActionScriptDefault_Text">currentDecoration</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Close the current decoration
</span>                        <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/span&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">openDecoration</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">openDecoration</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">currentDecoration</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">openDecoration</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">currentDecoration</span>;
                        <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;span class=&quot;&apos;</span>, <span class="ActionScriptDefault_Text">openDecoration</span>, <span class="ActionScriptString">&apos;&quot;&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptComment">// This interacts badly with some wikis which introduces paragraph tags
</span>                    <span class="ActionScriptComment">// into pre blocks for some strange reason.
</span>                    <span class="ActionScriptComment">// It&apos;s necessary for IE though which seems to lose the preformattedness
</span>                    <span class="ActionScriptComment">// of &lt;pre&gt; tags when their innerHTML is assigned.
</span>                    <span class="ActionScriptComment">// http://stud3.tuwien.ac.at/~e0226430/innerHtmlQuirk.html
</span>                    <span class="ActionScriptComment">// and it serves to undo the conversion of &lt;br&gt;s to newlines done in
</span>                    <span class="ActionScriptComment">// chunkify.
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">htmlChunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">textToHtml</span><span class="ActionScriptBracket/Brace">(</span>
                        <span class="ActionScriptDefault_Text">tabExpander</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceText</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">outputIdx</span>, <span class="ActionScriptDefault_Text">sourceIdx</span><span class="ActionScriptBracket/Brace">)))</span>
                        .<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lastWasSpace</span>
                                 <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">startOrSpaceRe</span>
                                 <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">adjacentSpaceRe</span>, <span class="ActionScriptString">&apos;$1&amp;nbsp;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptComment">// Keep track of whether we need to escape space at the beginning of the
</span>                    <span class="ActionScriptComment">// next chunk.
</span>                    <span class="ActionScriptDefault_Text">lastWasSpace</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trailingSpaceRe</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">htmlChunk</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">htmlChunk</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">newlineRe</span>, <span class="ActionScriptString">&apos;&lt;br /&gt;&apos;</span><span class="ActionScriptBracket/Brace">))</span>;
                    <span class="ActionScriptDefault_Text">outputIdx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceIdx</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Determine if we&apos;re going to consume a tag this time around.  Otherwise
</span>                <span class="ActionScriptComment">// we consume a decoration or exit.
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">outputTag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tagPos</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">extractedTags</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">decPos</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Pick one giving preference to extractedTags since we shouldn&apos;t open
</span>                        <span class="ActionScriptComment">// a new style that we&apos;re going to have to immediately close in order
</span>                        <span class="ActionScriptComment">// to output a tag.
</span>                        <span class="ActionScriptDefault_Text">outputTag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tagPos</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">&lt;=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">decPos</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">outputTag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">outputTag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">// Consume either a decoration or a tag or exit.
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">outputTag</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">emitTextUpTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tagPos</span><span class="ActionScriptBracket/Brace">])</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">openDecoration</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// Close the current decoration
</span>                        <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/span&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">openDecoration</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tagPos</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">])</span>;
                    <span class="ActionScriptDefault_Text">tagPos</span> <span class="ActionScriptOperator">+=</span> 2;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">decPos</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">decorations</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">emitTextUpTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">decPos</span><span class="ActionScriptBracket/Brace">])</span>;
                    <span class="ActionScriptDefault_Text">currentDecoration</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">decPos</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">decPos</span> <span class="ActionScriptOperator">+=</span> 2;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">emitTextUpTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceText</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">openDecoration</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&lt;/span&gt;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">html</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** Maps language-specific file extensions to handlers. */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">langHandlerRegistry</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{}</span>;
        <span class="ActionScriptASDoc">/** Register a language handler for the given file extensions.
         * @param {function (string) : Array.&lt;number|string&gt;} handler
         *     a function from source code to a list of decorations.
         * @param {Array.&lt;string&gt;} fileExtensions
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">handler</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">fileExtensions</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fileExtensions</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">--</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;=</span> 0;<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ext</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fileExtensions</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">langHandlerRegistry</span>.<span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ext</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">langHandlerRegistry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ext</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">handler</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span>  <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;cannot override language handler %s&apos;</span>, <span class="ActionScriptDefault_Text">ext</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">// Anirudh: Parsing existing HTML has been removed. The commented out line is still there though
</span>        <span class="ActionScriptComment">// This class contains functionality to parse generated HTML to rebuild the decorations array
</span>        <span class="ActionScriptComment">// this is unused as of now. To optimize, extractTags() and its dependant functions can be 
</span>        <span class="ActionScriptComment">// removed
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prettyPrintOne</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeHtml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">buildHTML</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">try</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptComment">// Extract tags, and convert the source code to plain text.       
</span>                <span class="ActionScriptComment">//Anirudh: Change not to do HTML extraction         
</span>                <span class="ActionScriptComment">//var sourceAndExtractedTags:Object = extractTags(sourceCodeHtml);                                
</span>                <span class="ActionScriptComment">//var sourceAndExtractedTags:Object = {source: sourceCodeHtml, tags: []};
</span>                
                <span class="ActionScriptComment">// Pick a lexer and apply it.
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">langHandlerRegistry</span>.<span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Treat it as markup if the first non whitespace character is a &lt; and
</span>                    <span class="ActionScriptComment">// the last non-whitespace character is a &gt;.
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">checkmark</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^\s*?&lt;/</span>;
                    <span class="ActionScriptDefault_Text">opt_langExtension</span> <span class="ActionScriptOperator">=</span>
                        <span class="ActionScriptDefault_Text">checkmark</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeHtml</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptString">&apos;default-markup&apos;</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;default-code&apos;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptASDoc">/** Even entries are positions in source in ascending order.  Odd enties
                 * are style markers (e.g., PR_COMMENT) that run from that position until
                 * the end.
                 * @type {Array.&lt;number|string&gt;}
                 */</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">langHandlerRegistry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">({}</span>, <span class="ActionScriptDefault_Text">sourceCodeHtml</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span>;
                <span class="ActionScriptComment">//Anirudh: added buildHTML variable, because during live syntax highlighting, I 
</span>                <span class="ActionScriptComment">//just need the mainDecorations to apply the correct TextRange sections
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">buildHTML</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptASDoc">/** Even entries are positions in source in ascending order.  Odd entries
                     * are tags that were extracted at that position.
                     * @type {Array.&lt;number|string&gt;}
                     */</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
                    <span class="ActionScriptComment">// Integrate the decorations and tags back into the source code to produce
</span>                    <span class="ActionScriptComment">// a decorated html string.
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">recombineTagsAndDecorations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeHtml</span>, <span class="ActionScriptDefault_Text">extractedTags</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">)</span>;                    
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
             <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//Added by Anirudh: For async mode
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">asyncRunning</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pseudoThread</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">PseudoThread</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pprintArgs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">chunksLen</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;

        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prettyPrintAsync</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeHtml</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">completeFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">intFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">systemManagerIn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ISystemManager</span>, <span class="ActionScriptDefault_Text">buildHTML</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">//process 100 chars (to the nearest newline) at a time
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceChunks</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceCodeHtml</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 100;            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">start</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0, <span class="ActionScriptDefault_Text">foundIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptComment">//trace(&quot;building arr&quot;);
</span>            <span class="ActionScriptReserved">do</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptDefault_Text">foundIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceCodeHtml</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\n&apos;</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">foundIndex</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1 <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">foundIndex</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">foundIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceCodeHtml</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\r&apos;</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">foundIndex</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1 <span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">foundIndex</span>;
                    <span class="ActionScriptBracket/Brace">}</span>                    
                <span class="ActionScriptBracket/Brace">}</span> 
                <span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&gt;=</span> <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">i</span>;
                <span class="ActionScriptDefault_Text">sourceChunks</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeHtml</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+=</span> 100;
                <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">end</span>;                       
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sourceChunks</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sourceChunks</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceChunks</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sourceChunks</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sourceCodeHtml</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">start</span><span class="ActionScriptBracket/Brace">)</span>;    
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">chunksLen</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceChunks</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptComment">//trace(&quot;total chunks &quot; + sourceChunks.length);
</span>            <span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">mainHtml</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptDefault_Text">prettyPrintStopAsyc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">asyncRunning</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptComment">//trace(&quot;starting code highlight with &quot; + sourceChunks.length);            
</span>            <span class="ActionScriptDefault_Text">pprintArgs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sourceChunks</span>, 0, <span class="ActionScriptDefault_Text">completeFn</span>, <span class="ActionScriptDefault_Text">intFn</span>, <span class="ActionScriptDefault_Text">opt_langExtension</span>, <span class="ActionScriptDefault_Text">buildHTML</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">pseudoThread</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">PseudoThread</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">systemManagerIn</span>, <span class="ActionScriptDefault_Text">prettyPrintAsyncWorker</span>, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptDefault_Text">pprintArgs</span>, 1, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//setTimeout(prettyPrintAsyncWorker, 250, sourceChunks, 0, completeFn, intFn, opt_langExtension, buildHTML);
</span>              
        <span class="ActionScriptBracket/Brace">}</span>        
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prettyPrintAsyncWorker</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeArr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>,  <span class="ActionScriptDefault_Text">sourceCodeIdx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">completeFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">intFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">buildHTML</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">prettyPrintStopAsyc</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">mainHtml</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
                <span class="ActionScriptDefault_Text">asyncRunning</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>; 
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;stopping lexing thread&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">try</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Extract tags, and convert the source code to plain text.
</span>                
                <span class="ActionScriptDefault_Text">mainHtml</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">sourceCodeArr</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sourceCodeIdx</span><span class="ActionScriptBracket/Brace">]</span>;                
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;started async&apos;</span><span class="ActionScriptBracket/Brace">)</span>;                
                <span class="ActionScriptComment">//Anirudh: Change not to do HTML extraction
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceAndExtractedTags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptDefault_Text">tags</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptBracket/Brace">[]</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptBracket/Brace">}</span>;
                                
                <span class="ActionScriptComment">// Pick a lexer and apply it.
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">langHandlerRegistry</span>.<span class="ActionScriptDefault_Text">hasOwnProperty</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// Treat it as markup if the first non whitespace character is a &lt; and
</span>                    <span class="ActionScriptComment">// the last non-whitespace character is a &gt;.
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">checkmark</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">/^\s*?&lt;/</span>;
                    <span class="ActionScriptDefault_Text">opt_langExtension</span> <span class="ActionScriptOperator">=</span>
                        <span class="ActionScriptDefault_Text">checkmark</span>.<span class="ActionScriptDefault_Text">test</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mainHtml</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptString">&apos;default-markup&apos;</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;default-code&apos;</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptASDoc">/** Even entries are positions in source in ascending order.  Odd enties
                 * are style markers (e.g., PR_COMMENT) that run from that position until
                 * the end.
                 * @type {Array.&lt;number|string&gt;}
                 */</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">langHandlerRegistry</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">opt_langExtension</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">({}</span>, <span class="ActionScriptDefault_Text">mainHtml</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;decorated&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mainDecorations</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">decorations</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">sourceCodeIdx</span> <span class="ActionScriptOperator">+</span> 1 <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">chunksLen</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                      <span class="ActionScriptComment">//Anirudh: added buildHTML variable, because during live syntax highlighting, I 
</span>                    <span class="ActionScriptComment">//just need the mainDecorations to apply the correct TextRange sections
</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">buildHTML</span> <span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptASDoc">/** Even entries are positions in source in ascending order.  Odd entries
                         * are tags that were extracted at that position.
                         * @type {Array.&lt;number|string&gt;}
                         */</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">extractedTags</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourceAndExtractedTags</span>.<span class="ActionScriptDefault_Text">tags</span>;
                        <span class="ActionScriptComment">// Integrate the decorations and tags back into the source code to produce
</span>                        <span class="ActionScriptComment">// a decorated html string.
</span>                        <span class="ActionScriptDefault_Text">mainHtml</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">recombineTagsAndDecorations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mainHtml</span>, <span class="ActionScriptDefault_Text">extractedTags</span>, <span class="ActionScriptDefault_Text">decorations</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;built html&apos;</span><span class="ActionScriptBracket/Brace">)</span>;                    
                    <span class="ActionScriptBracket/Brace">}</span>

                    <span class="ActionScriptDefault_Text">asyncRunning</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                    <span class="ActionScriptDefault_Text">completeFn</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;async worker &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">sourceCodeIdx</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">intFn</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">intFn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceCodeIdx</span>, <span class="ActionScriptDefault_Text">chunksLen</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptComment">//setTimeout(prettyPrintAsyncWorker, 250, sourceCodeArr, sourceCodeIdx + 1, completeFn, intFn, opt_langExtension, buildHTML);
</span>                <span class="ActionScriptBracket/Brace">}</span>
                
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">catch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">asyncRunning</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">completeFn</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptBracket/Brace">}</span>
             <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">CodePrettyPrint</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">regexpPrecederPattern</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">decorateSource</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;default-code&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">decorateMarkup</span>,
                                <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;default-markup&apos;</span>, <span class="ActionScriptString">&apos;html&apos;</span>, <span class="ActionScriptString">&apos;htm&apos;</span>, <span class="ActionScriptString">&apos;xhtml&apos;</span>, <span class="ActionScriptString">&apos;xml&apos;</span>, <span class="ActionScriptString">&apos;xsl&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">CPP_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">cStyleComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;c&apos;</span>, <span class="ActionScriptString">&apos;cc&apos;</span>, <span class="ActionScriptString">&apos;cpp&apos;</span>, <span class="ActionScriptString">&apos;cs&apos;</span>, <span class="ActionScriptString">&apos;cxx&apos;</span>, <span class="ActionScriptString">&apos;cyc&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">JAVA_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">cStyleComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;java&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">SH_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">multiLineStrings</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;bsh&apos;</span>, <span class="ActionScriptString">&apos;csh&apos;</span>, <span class="ActionScriptString">&apos;sh&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">PYTHON_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">multiLineStrings</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">tripleQuotedStrings</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;cv&apos;</span>, <span class="ActionScriptString">&apos;py&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">PERL_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">multiLineStrings</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">regexLiterals</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;perl&apos;</span>, <span class="ActionScriptString">&apos;pl&apos;</span>, <span class="ActionScriptString">&apos;pm&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">RUBY_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">hashComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">multiLineStrings</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">regexLiterals</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;rb&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">JSCRIPT_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">cStyleComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">regexLiterals</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;js&apos;</span><span class="ActionScriptBracket/Brace">])</span>;
             <span class="ActionScriptDefault_Text">registerLangHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourceDecorator</span><span class="ActionScriptBracket/Brace">({</span>
                      <span class="ActionScriptDefault_Text">keywords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">PHP_KEYWORDS</span>,
                            <span class="ActionScriptDefault_Text">cStyleComments</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>,
                            <span class="ActionScriptDefault_Text">regexLiterals</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>
                            <span class="ActionScriptBracket/Brace">})</span>, <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&apos;php&apos;</span><span class="ActionScriptBracket/Brace">])</span>;                       
            
        <span class="ActionScriptBracket/Brace">}</span>
        
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
